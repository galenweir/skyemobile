<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height">
    <title>基础漏斗图</title>
    <style>::-webkit-scrollbar{display:none;}html,body{overflow:hidden;height:100%;margin:0;}</style>
</head>
<body>
<div id="mountNode"></div>
<script>/*Fixing iframe window.innerHeight 0 issue in Safari*/document.body.clientHeight;</script>
<script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.g2-3.5.1/dist/g2.min.js"></script>
<script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.data-set-0.10.1/dist/data-set.min.js"></script>
<script>
  var _DataSet = DataSet,
    DataView = _DataSet.DataView;

  var data = [{
    action: '已进单',
    pv: 48687
  }, {
    action: '已审核',
    pv: 38950
  }, {
    action: '已生产',
    pv: 27265
  }, {
    action: '已打印',
    pv: 20449
  }, {
    action: '已扫描',
    pv: 13292
  }, {
    action: '已称重',
    pv: 11962
  }, {
    action: '完成出库',
    pv: 9570
  }];
  var dv = new DataView().source(data);
  dv.transform({
    type: 'map',
    callback: function callback(row) {
      row.percent = row.pv / 48687;
      return row;
    }
  });
  data = dv.rows;
  var chart = new G2.Chart({
    container: 'mountNode',
    forceFit: true,
    height: window.innerHeight,
    padding: [40, 80, 70]
  });
  chart.source(data, {
    percent: {
      nice: false
    }
  });
  chart.axis(false);
  chart.tooltip({
    showTitle: false,
    itemTpl: '<li data-index={index} style="margin-bottom:4px;">' + '<span style="background-color:{color};" class="g2-tooltip-marker"></span>' + '{name}<br/>' + '<span style="padding-left: 16px">订单数：{pv}</span><br/>' + '<span style="padding-left: 16px">占比：{percent}</span><br/>' + '</li>'
  });
  chart.coord('rect').transpose().scale(1, -1);
  chart.intervalSymmetric().position('action*percent').shape('funnel').color('action', ['#FF6600', '#FFCC66', '#33CC00', '#0066FF', '#6666FF']).label('action*pv', function(action, pv) {
    return action + ' ' + pv;
  }, {
    offset: 10,
    labelLine: {
      lineWidth: 1,
      stroke: 'rgba(0, 0, 0, 0.15)'
    }
  }).tooltip('action*pv*percent', function(action, pv, percent) {
    return {
      name: action,
      percent: parseInt(percent * 100) + '%',
      pv: pv
    };
  });
  data.forEach(function(obj) {
    // 中间标签文本
    chart.guide().text({
      top: true,
      position: {
        action: obj.action,
        percent: 'median'
      },
      content: parseInt(obj.percent * 100) + '%', // 显示的文本内容
      style: {
        fill: '#fff',
        fontSize: '12',
        textAlign: 'center',
        shadowBlur: 2,
        shadowColor: 'rgba(0, 0, 0, .45)'
      }
    });
  });
  chart.render();
</script>
</body>
</html>